{% assign enable_history = true %}
{%- assign daysProductPriceValidUntil = 90 | times: 86400 %}
<script
  type="application/json"
  data-section-type="page-product"
  data-section-id="{{ section.id }}"
  data-section-data
>
  {%
    render 'product-json',
    enable_history: enable_history
  %}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "{{ product.title }}",
  "image": "{{ product.featured_image |img_url }}",
  "description": {{ product.description  | escape | strip_html | json}},
  "sku": "{{ product.selected_or_first_available_variant.sku }}",
  "brand": {
    "@type": "Brand",
    "name": "{{ product.vendor }}"
  },
  "offers": {
    "@type": "Offer",
    "url": "{{ shop.url }}{{ product.url }}",
    "priceCurrency": "{{ shop.currency }}",
    "price": "{{ product.price }}",
    "priceValidUntil": "{{"now" | date: "%s" | plus: daysProductPriceValidUntil | date: "%Y-%m-%d"}}",
    "itemCondition": "https://schema.org/NewCondition",
    "availability": "http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}",
    "seller": {
      "@type": "Organization",
      "name": {{ shop.name | escape | strip_html | json }}
    },
    "shippingDetails": {
      "@type": "OfferShippingDetails",
      "shippingRate": {
        "@type": "MonetaryAmount",
        "value": "Free",
        "currency": "USD"
      },
      "shippingDestination": {
        "@type": "DefinedRegion",
        "addressCountry": "US"
      },
      "deliveryTime": {
        "@type": "ShippingDeliveryTime",
        "transitTime": {
          "@type": "QuantitativeValue",
          "minValue": 1,
          "maxValue": 2,
          "unitCode": "d"
        },
        "handlingTime": {
          "@type": "QuantitativeValue",
          "minValue": 1,
          "maxValue": 2,
          "unitCode": "d"
        }
      }
    },
    "hasMerchantReturnPolicy": {
      "@type": "MerchantReturnPolicy",
      "returnPolicyCategory": "https://schema.org/ReturnShippingFees",
      "merchantReturnDays": 15
    }
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "{% if product.metafields.reviews.rating.value != blank %}{{ product.metafields.reviews.rating.value }}{% else %}4.8{% endif %}",
    "reviewCount": "{% if product.metafields.reviews.rating_count.value != blank %}{{ product.metafields.reviews.rating_count.value }}{% else %}25{% endif %}"
  }
}
</script>




{% capture product_form_id %}{{- 'product-form-' | append: section.id -}}{% endcapture %}

<div class="product-wrap clearfix" itemscope itemtype="http://schema.org/Product">
  {% if product != blank %}
    {% form 'product', product, class: 'product', id: product_form_id, data-product-form: '' %}
      {%
        render 'product-blocks',
        product: product,
        section: section,
        form: form,
        form_id: product_form_id,
      %}
    {% endform %}
  {% else %}
    <div class="product" data-product-form>
      {%
        render 'product-blocks',
        product: product,
        section: section,
        form: nil,
        form_id: product_form_id,
      %}
    </div>
  {% endif %}
</div>

{% schema %}
{
  "name": "Product pages",
  "class": "page-product",
  "settings": [
    {
      "type": "header",
      "content": "Blocks"
    },
    {
      "type": "paragraph",
      "content": "Learn more about [block positioning](https://support.pixelunion.net/hc/en-us/articles/360026262134)"
    },
    {
      "type": "header",
      "content": "Media"
    },
    {
      "type": "paragraph",
      "content": "Learn more about [media types](https://help.shopify.com/en/manual/products/product-media/product-media-types)"
    },
    {
      "type": "checkbox",
      "id": "enable_zoom",
      "label": "Enable image zoom",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "gallery_enable_video_autoplay",
      "label": "Enable video autoplay",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "gallery_enable_video_looping",
      "label": "Enable video looping",
      "default": true
    }
  ],
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "title",
      "name": "Title",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "vendor",
      "name": "Vendor",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "sku",
      "name": "SKU",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "price",
      "name": "Price",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "variant_selection",
      "name": "Variant selection",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "quantity",
      "name": "Quantity",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "gallery",
      "name": "Gallery",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "form",
      "name": "Buy buttons",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "Customize form features for the product in the products portion of the theme settings."
        },
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        },
        {
          "type": "checkbox",
          "id": "show_gift_card_recipient_form",
          "label": "t:sections.product.blocks.form.show_gift_card_recipient_form.label",
          "info": "t:sections.product.blocks.form.show_gift_card_recipient_form.info",
          "default": false
        }
      ]
    },
    {
      "type": "description",
      "name": "Description",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "share",
      "name": "Share",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "text",
      "name": "Text",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Text block</p>"
        },
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "rating",
      "name": "Product rating",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "To display a rating, add a product rating app. [Learn more](https://apps.shopify.com/product-reviews)"
        },
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "alignment",
      "name": "App block alignment",
      "settings": [
        {
          "type": "paragraph",
          "content": "Use this block before an app block to set the app block's position. Otherwise, app blocks will inherit the position of the block before them."
        },
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    },
    {
      "type": "complementary_products",
      "name": "Complementary products",
      "limit": 1,
      "settings": [
        {
          "type": "paragraph",
          "content": "To select complementary products, add the Search & Discovery app. [Learn more](https:\/\/shopify.dev\/themes\/product-merchandising\/recommendations)"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Pairs well with"
        },
        {
          "type": "range",
          "id": "product_recommendation_limit",
          "label": "Maximum products to show",
          "min": 1,
          "max": 10,
          "default": 5
        },
        {
          "type": "range",
          "id": "products_per_slide",
          "label": "Number of products per page",
          "min": 1,
          "max": 3,
          "default": 2
        },
        {
          "type": "select",
          "id": "position",
          "label": "Position",
          "options": [
            {
              "value": "top",
              "label": "Center (top)"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            },
            {
              "value": "bottom",
              "label": "Center (bottom)"
            }
          ],
          "default": "top"
        }
      ]
    }
  ]
}

{% endschema %}